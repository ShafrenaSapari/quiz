import{d as L,u as O,g as c,q as _,h as R,r as x,i as C,c as a,o as r,a as o,t as i,b as Q,F as W,j as Z,k as u,l as j,m as d,v as z,n as p,p as K,s as T,x as A,f as H}from"./index-Dz7mnVXb.js";const Y={key:0,class:"quiz-container"},$={class:"quiz-nav"},G=["disabled"],J={class:"question-number"},X={class:"question-container"},ee={class:"question"},oe=["src"],se={class:"choices-container"},ne=["onClick"],te={key:1,class:"quiz-container quiz-container--form"},ie=["src"],ae={class:"form-group"},re={key:0,class:"form-error"},le={class:"form-group"},ue={key:0,class:"form-error"},ce={class:"form-group"},de={key:0,class:"form-error"},pe={class:"form-group"},me={key:0,class:"form-error"},he={class:"form-group"},fe={key:0,class:"form-error"},be={class:"form-group consent-group"},ve={class:"form-consent"},ze={key:0,class:"form-error"},ge={class:"submit-container"},ye=["disabled"],_e={key:0,class:"form-error form-error--inline"},Se=L({__name:"QuizView",setup(qe){const P=H(),l=O(),U=_.length,m=c(()=>l.questionIndex.value),V=c(()=>l.quizCompleted.value),q=c(()=>_[m.value]),B=c(()=>R[m.value]),k=c(()=>l.selectedChoices.value),S=c(()=>m.value>0),n=x({name:"",email:"",phone:"",dob:"",citizenship:"",consent:!1}),s=x({name:"",email:"",phone:"",dob:"",citizenship:"",consent:""}),f=C(!1),b=C("");function E(v){l.answerQuestion(v)}function M(){S.value&&l.goToPreviousQuestion()}function N(){return s.name=n.name.trim()?"":"Name is required",s.email=/.+@.+\..+/.test(n.email.trim())?"":"Enter a valid email address",s.phone=n.phone.trim().length>=7?"":"Enter a valid phone number",s.dob=n.dob?"":"Date of birth is required",s.citizenship=n.citizenship?"":"Select your citizenship",s.consent=n.consent?"":"Please consent to continue",!s.name&&!s.email&&!s.phone&&!s.dob&&!s.citizenship&&!s.consent}async function D(){if(b.value="",!N())return;const v="https://script.google.com/macros/s/AKfycbxl4M4ALbnlckMWI-EMh5xmUk0WojZ1Z27ExPULdcD6dZWe8SNH8NzWKZbDPae2jMBpFw/exec";f.value=!0;try{const e=new FormData;e.append("name",n.name),e.append("email",n.email),e.append("phone",n.phone),e.append("dob",n.dob),e.append("citizenship",n.citizenship),e.append("consent",n.consent?"yes":"no");const t=l.predictPersona();t.persona&&(e.append("personaId",t.persona.id),e.append("personaName",t.persona.name),e.append("personaHeadline",t.persona.headline)),e.append("personaQualified",t.personaQualified?"yes":"no");const h=k.value.map((y,F)=>{const w=_[F],I=y>=0?w.choices[y]:"";return{question:w.question,choiceIndex:y,choiceLabel:I}});e.append("responses",JSON.stringify(h));const g=await fetch(v,{method:"POST",body:e});if(!g.ok)throw new Error(`Submission failed with status ${g.status}`);l.revealResult(),P.push({name:"results"})}catch(e){console.error("Form submission failed",e),b.value="Unable to submit the form right now. Please try again."}finally{f.value=!1}}return(v,e)=>V.value?(r(),a("div",te,[o("form",{class:"form-card",onSubmit:A(D,["prevent"])},[o("img",{src:Q(j),alt:"Quiz wrap-up",class:"form-card__image"},null,8,ie),e[13]||(e[13]=o("h2",{class:"form-card__title"},"Share your details to learn about your kuih-nomics!",-1)),o("div",ae,[e[6]||(e[6]=o("label",{class:"form-label",for:"quiz-name"},"Name",-1)),d(o("input",{id:"quiz-name","onUpdate:modelValue":e[0]||(e[0]=t=>n.name=t),type:"text",name:"name",class:p(["form-input",{"has-error":s.name}]),autocomplete:"name",placeholder:"Your name"},null,2),[[z,n.name]]),s.name?(r(),a("p",re,i(s.name),1)):u("",!0)]),o("div",le,[e[7]||(e[7]=o("label",{class:"form-label",for:"quiz-email"},"Email address",-1)),d(o("input",{id:"quiz-email","onUpdate:modelValue":e[1]||(e[1]=t=>n.email=t),type:"email",name:"email",class:p(["form-input",{"has-error":s.email}]),autocomplete:"email",placeholder:"you@example.com"},null,2),[[z,n.email]]),s.email?(r(),a("p",ue,i(s.email),1)):u("",!0)]),o("div",ce,[e[8]||(e[8]=o("label",{class:"form-label",for:"quiz-phone"},"Phone number",-1)),d(o("input",{id:"quiz-phone","onUpdate:modelValue":e[2]||(e[2]=t=>n.phone=t),type:"tel",name:"phone",class:p(["form-input",{"has-error":s.phone}]),autocomplete:"tel",placeholder:"e.g. +65 9123 4567"},null,2),[[z,n.phone]]),s.phone?(r(),a("p",de,i(s.phone),1)):u("",!0)]),o("div",pe,[e[9]||(e[9]=o("label",{class:"form-label",for:"quiz-dob"},"Date of birth",-1)),d(o("input",{id:"quiz-dob","onUpdate:modelValue":e[3]||(e[3]=t=>n.dob=t),type:"date",name:"dob",class:p(["form-input",{"has-error":s.dob}])},null,2),[[z,n.dob]]),s.dob?(r(),a("p",me,i(s.dob),1)):u("",!0)]),o("div",he,[e[11]||(e[11]=o("label",{class:"form-label",for:"quiz-citizenship"},"Citizenship",-1)),d(o("select",{id:"quiz-citizenship","onUpdate:modelValue":e[4]||(e[4]=t=>n.citizenship=t),name:"citizenship",class:p(["form-input",{"has-error":s.citizenship}])},[...e[10]||(e[10]=[o("option",{value:"",disabled:""},"Select an option",-1),o("option",{value:"Singaporean"},"Singaporean",-1),o("option",{value:"Singapore Permanent Resident"},"Singapore Permanent Resident",-1),o("option",{value:"Others"},"Others",-1)])],2),[[K,n.citizenship]]),s.citizenship?(r(),a("p",fe,i(s.citizenship),1)):u("",!0)]),o("div",be,[o("label",ve,[d(o("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>n.consent=t),type:"checkbox",class:"consent-checkbox"},null,512),[[T,n.consent]]),e[12]||(e[12]=o("span",null,"I agree to share my details for the Kuih-nomics experience.",-1))]),s.consent?(r(),a("p",ze,i(s.consent),1)):u("",!0)]),e[14]||(e[14]=o("p",{class:"form-disclaimer"}," By submitting this form, you consent to be contacted for financial advisory purposes, including updates, events and relevant information. Your data will be kept confidential and used solely for purposes related to our initiatives. ",-1)),o("div",ge,[o("button",{class:"btn whoosh-button submit-button",type:"submit",disabled:f.value},i(f.value?"Cooking…":"Let's masak our kuih!"),9,ye)]),b.value?(r(),a("p",_e,i(b.value),1)):u("",!0)],32)])):(r(),a("div",Y,[o("div",$,[o("button",{class:"quiz-back-button",disabled:!S.value,type:"button",onClick:M}," ← Back ",8,G),o("div",J,"Q"+i(m.value+1)+"/"+i(Q(U)),1)]),o("div",X,[o("div",ee,i(q.value.question),1),o("img",{src:B.value,alt:"Question Scene",class:"question-image"},null,8,oe)]),o("div",se,[(r(!0),a(W,null,Z(q.value.choices,(t,h)=>(r(),a("button",{key:h,class:p(["btn","choice",{"choice-selected":k.value[m.value]===h}]),onClick:g=>E(h)},i(t),11,ne))),128))])]))}});export{Se as default};
